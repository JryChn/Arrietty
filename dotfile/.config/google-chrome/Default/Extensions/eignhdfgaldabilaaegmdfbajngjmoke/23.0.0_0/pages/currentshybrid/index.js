"use strict";cjce.registerTemplate("bm-p-currentshybrid",function(c,t){var n,a,s,i,o,l,r,m,d,u,b=!cjBasics.wrif.supported||!cjgApis.session.account.validSession,p="#1a73e8",h=cjBasics.lang.i18n("cj_i18n_01772","Currents"),g=cjBasics.lang.i18n("cj_i18n_00417","Google+"),j=h,_="/"+t.wizPath,f="https://currents.google.com",v="https://plus.google.com",e=v+_,w=f+_,B=w,C=w,T=t.account.obfuscatedId,S=!1,U=["stream","tags","communities","me","people","notifications","discover","collections","explore","settings"];var N,x,L,W,k,y,P,E,I={stream:{label:cjBasics.lang.i18n("cj_i18n_00291","Home"),iconName:"__mdi:home",newTabUrl:""},tags:{label:cjBasics.lang.i18n("cj_i18n_06609","Tags"),iconName:"__mdi:tag",newTabUrl:"tags/recommended"},discover:{label:cjBasics.lang.i18n("cj_i18n_00926","Discover"),iconName:"__mdi:explore",newTabUrl:"discover"},explore:{label:cjBasics.lang.i18n("cj_i18n_00485","Whatâ€™s hot"),iconName:"__mdi:whatshot",newTabUrl:"explore",divider:!0},collections:{label:cjBasics.lang.i18n("cj_i18n_00292","Collections"),iconName:"__mdi:google_collections",newTabUrl:"collections"},communities:{label:cjBasics.lang.i18n("cj_i18n_00293","Communities"),iconName:"__mdi:communities",newTabUrl:"communities"},me:{label:cjBasics.lang.i18n("cj_i18n_00294","Profile"),iconName:"__mdi:account_circle",newTabUrl:T},people:{label:cjBasics.lang.i18n("cj_i18n_00295","People"),iconName:"__mdi:people",newTabUrl:"people"},notifications:{label:cjBasics.lang.i18n("cj_i18n_00296","Notifications"),iconName:"__mdi:notifications",newTabUrl:"notifications/all",divider:!0},settings:{label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),iconName:"__mdi:settings",newTabUrl:"settings"},up:{label:cjBasics.lang.i18n("cj_i18n_06610","Join Currents"),iconName:"__mdi:login",newTabUrl:"up"}};function A(e){return e.map(function(e){var n=I[e];return n.id=e,n})}function O(e){t.openTab(B+e)}function G(e,n){O(n.newTabUrl)}function D(e,n){var i=n.newTabUrl,c=("collections"===e||"communities"===e||"people"===e||"stream"===e)&&o.value;c&&(i="s/"+encodeURIComponent(c),"stream"!==e&&(i+="/"+e)),O(i)}function R(e){O("s/"+encodeURIComponent(e))}function z(){O("")}function H(){c.textContent="",s=cjce.createElement("bm-ogb",{serviceIcon:"currents",serviceLabel:j,pageLabel:cjBasics.lang.i18n("cj_i18n_01167","Links"),searchbox:{color:p,submitInNewTab:!0,onSubmit:R},bmApis:t,onNewTab:z}),c.appendChild(s),o=s.cjceSearchboxEl,t.setOnPageDisplayHandler(o.select);var e=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"});c.appendChild(e),u=A(U),i=cjce.createElement("bm-navlist",{color:!0,items:u,onClick:D,onNewTab:D}),e.appendChild(i)}function q(){m.cjceGetCleanUrl(f).then(function(e){e?t.openTab(e):O("back"===x?"":x)})}function F(e){var n=cjBasics.urlParams.attach(e,E),i=++y;k.then(function(){y===i&&m.cjceSendFrameCommand({method:"bmCstUpdatePath",value:n})})}function M(e,n){var i=I[e];!n&&x===e||(x=e,F(_+i.newTabUrl),s.cjceSetPageLabel(i.label))}function J(){i=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:x,items:u,onChange:function(e){M(e)},onNewTab:G}),l.textContent="",l.appendChild(i)}function V(){return cjBasics.urlParams.attach(C+function(){if(!i)return"";var e=i.cjceSelectedId,n=I[e].newTabUrl;return"string"==typeof n?n:""}(),E)}function K(e){var n;!1===W&&(W=!0,L()),x="/"===(n=e)||"/stream"===n||"/stream/"===n?"stream":"/discover"===n||"/discover/"===n?"discover":n.startsWith("/settings")?"settings":n.startsWith("/people")||n.startsWith("/circles")?"people":n.startsWith("/notifications")?"notifications":n.startsWith("/tags")?"tags":"/me"===n||"/me/"===n||n==="/"+T||n==="/"+T+"/"||n==="/"+T+"/posts"||n==="/"+T+"/posts/"?"me":n.startsWith("/explore")?"explore":n.startsWith("/up")?"up":"/s"===n||n.startsWith("/s/")?"search":"/collections"===n||"/collections/"===n||n.startsWith("/collections/featured")||n.startsWith("/collections/followed")||n.startsWith("/collections/yours")?"collections":"/communities"===n||"/communities/"===n||n.startsWith("/communities/member")||n.startsWith("/communities/member/")||n.startsWith("/communities/yours")||n.startsWith("/communities/yours/")?"communities":"back",r.hidden="back"!==x,s.cjceSetBackState("search"===x),d.hidden=!S||!("stream"===x||"search"===x),"back"!==x&&(i.cjceSelectedId=x,I[x]&&s.cjceSetPageLabel(I[x].label))}function Q(){o.value="",o.focus(),s.cjceSetNavigatorCollapseState(!1),M(N,!0)}function X(){var e;n||(n=!0,u=A(["communities","notifications","collections","discover","explore","up"]),x=N="up",s.cjceSetPageLabel(I[x].label),J(),e=V(),m?m.src=e:k.then(function(){m.src=e}))}function Y(e){var n,i;a&&!e||(a=!0,n=cjBasics.lang.i18n("cj_i18n_01773","__product_name__ is only available for G Suite accounts.").replace("__product_name__",j),e&&(n=cjBasics.lang.i18n("cj_i18n_00336","Google+ is not available for your organization. Please contact your administrator to enable this service for at least one user in the organization.").replace(g,h)),c.textContent="",i=cjce.createElement("bm-fulldialog",{bmApis:t,onNewTab:z,lockup:{label:j},iconName:"currents",message:n,actionLabel:cjBasics.lang.i18n("cj_i18n_01543","Switch account"),action:function(){t.pageManager.navigate("accountchooser")}}),c.appendChild(i))}function Z(){cjgApis.info.getUserDomain(t.account).then(function(e){e||Y()}),(t.account.validSession?cjBasics.ajax(e).then(function(e){return e||""},function(e){return e&&e.body||""}).then(function(e){return-1!==e.indexOf("Join Google+")||-1!==e.indexOf('rel="canonical" href="https://plus.google.com/discover')?"disabled":-1!==e.indexOf("<title>Google</title>")?"disabledAdministrator":"enabled"}):Promise.resolve("invalidSession")).then(function(e){!0!==e&&("disabled"!==e&&"invalidSession"!==e?"disabledAdministrator"===e&&Y(!0):X())})}b?H():(b=!0,setTimeout(function(){b&&!a&&H()},4e3),u=A(U),x=N="stream",W=!1,k=new Promise(function(e){L=e}),y=0,P=cjBasics.uniqueId.generate(),E={bm_cid:"currentshybrid",bm_cst:"2",bm_wiz:"1",bm_iid:P,hl:cjBasics.lang.current},cjBasics.webRequest.handleIframeHeaders([f+"/*bm_iid="+P+"*",v+"/*bm_iid="+P+"*"],{handleFirefoxInject:!0}),function(){Z();var e=function(){var e=cjce.createElement("cjmd-container"),n=V();m=cjce.createElement("bm-iframe",{src:n,solid:"#fff",onLoad:function(){s.cjceSetLoading(!1)},onMessage:function(e){var n,i=e.bm_method,c=e.bm_value;"currentshybridWebsiteOrigin"===i?(b=!1,c===v&&(C=c+_)):"currentshybridPageTitle"===i?"back"===x&&r.cjceSetPageLabel(c):"currentshybridWebsiteView"===i?K(c):"currentshybridGsuiteLimit"===i?(d.cjceChecked=c,S||(S=!0,"stream"!==x&&"search"!==x||(d.hidden=!1))):"bmCstOpenUrl"===i&&(n=cjBasics.cleanBmUrl(c),t.openTab(n))}});var i=cjBasics.webRequest.addListener("onBeforeRedirect",function(e){e.redirectUrl.startsWith(w+"up")&&(X(),i.removeListener(),i=null)},{types:["sub_frame"],urls:[n]});return e.appendChild(m),e}();s=cjce.createElement("bm-ogb",{drawer:{color:!0},loading:!0,serviceIcon:"currents",serviceLabel:j,pageLabel:I[x].label,searchbox:{color:p,onClear:Q,onSubmit:function(e){F("s/"+encodeURIComponent(e))},onMetaSubmit:R},bmApis:t,onNewTab:q,onBack:Q}),c.appendChild(s),l=s.cjceDrawerEl,o=s.cjceSearchboxEl,(d=cjce.createElement("cjmd-switch",{icon:"__mdi:business",onChange:function(){s.cjceSetLoading(!0),m.cjceSendFrameCommand({method:"bmCstClickDomElement",value:'c-wiz > div[data-checked-veid][data-unchecked-veid][jslog][role="checkbox"][title][aria-checked][aria-label]'},f)}})).hidden=!0,s.cjceAppendChild(d),(r=cjce.createElement("bm-ogb",{displayBack:!0,floating:!0,serviceLabel:j,pageLabel:cjBasics.lang.i18n("cj_i18n_01174","Loading"),bmApis:t,onNewTab:q,onBack:Q})).hidden=!0,c.appendChild(r),J(),t.setOnPageDisplayHandler(o.select),c.appendChild(e),M(x)}())});