"use strict";cjce.registerTemplate("bm-p-portal",function(n,g){var v,t,f,i="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,b=["applauncher","customize","notifications","extensionsettings","accountchooser","removedialog"],h="",j="search",_="search",C=!1;function E(e){if(e.shortcutId){var a=cjgShortcuts.getUrl(e.shortcutId,g.account);if(a)return void g.openTab(a)}e.url&&g.openTab(e.url)}g.darkMode&&n.style.setProperty("--background-color","#2d2d2d");var L={},k={};function c(a,e){var n=g.servicesDatabase[a],t=n.iconName||"placeholder";g.darkMode&&"googleg"===t&&(t="search");var i,c,o,s,r=cjce.createElement("cjmd-item",{icon:{serviceName:t},label:n.label});return r.classList.add("bm-p-portal-pageitem"),r.dataset.id=a,r.tabIndex=0,r.style.color=(i=n.color)?!0===i?g.darkMode?"#669df6":"#1a73e8":i:g.darkMode?"rgba(255, 255, 255, 0.8)":"#212121",e?(r.draggable=!0,(c=cjce.createElement("cjmd-icon",{name:"__mdi:drag_indicator",size:20})).classList.add("bm-p-portal-pageitem__dragicon"),r.appendChild(c),(o=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:delete",label:cjBasics.lang.i18n("cj_i18n_01164","Remove from menu"),onClick:function(e){g.userServices.remove(a),r.remove(),h=h.replace("_"+a+"_","_"),e.stopPropagation()}})).classList.add("bm-p-portal-pageitem__remove"),r.appendChild(o)):(n.shortcutId||n.url)&&((s=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:open_in_new",label:cjBasics.lang.i18n("cj_i18n_00084","Open service in new tab"),onClick:function(e){E(n),e.stopPropagation()}})).classList.add("bm-p-portal-pageitem__open-in-new"),r.appendChild(s)),r}function w(e){e===j?g.pageManager.navigate(_):g.pageManager.navigate(e)}function M(){var n=(-1!==window.location.search.indexOf("debug")||!g.account.pageId)&&C,t=document.createDocumentFragment();(v||[]).forEach(function(e){var a;g.servicesDatabase[e]&&(a=c(e,n),k[e]=a,t.appendChild(a))});var e=k[j];e&&e.classList.add("cjmd-item--selected"),f.textContent="",f.appendChild(t),e&&x(e)}function x(e){var a,n=f.scrollTop,t=e.offsetTop,i=t-60;i<n?f.scrollTop=i:n<(a=t-f.offsetHeight-4)&&(f.scrollTop=a)}function o(e){var a=v.indexOf(j),n=(n=v[a+(e?-1:1)])||(e?v[v.length-1]:v[0]);g.pageManager.navigate(n)}function z(e){"removedialog"===j&&g.pageManager.navigate("customize")}function B(e){e.preventDefault()}function N(e){e.preventDefault();var a=e.dataTransfer.getData("serviceId"),n=e.target,t=n;24<e.offsetY&&n.nextSibling&&(t=n.nextSibling);var i,c=t.dataset.id,o=v.indexOf(c);n===f||-1===o?g.userServices.add(a):(-1!==(i=v.indexOf(a))&&v.splice(i,1),v.splice(o,0,a),g.userServices.set(v)),z()}function S(e){g.pageManager.navigate("removedialog"),e.dataTransfer.setData("serviceId",e.target.dataset.id)}!function(){g.darkMode&&n.classList.add("cjmd--dark");var e=function(){var e=cjce.createElement("cjmd-appbar"),a=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:apps",label:cjBasics.lang.i18n("cj_i18n_00216","Apps"),onClick:function(){w("applauncher")}});a.classList.add("bm-p-portal-pageicon"),L.applauncher=a,e.appendChild(a);var n,t,i,c,o=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),onClick:function(){w("extensionsettings")}});return o.classList.add("bm-p-portal-pageicon"),L.extensionsettings=o,e.appendChild(o),g.account.validSession?((n=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:notifications",label:cjBasics.lang.i18n("cj_i18n_00296","Notifications"),onClick:function(){w("notifications")}})).classList.add("bm-p-portal-pageicon"),L.notifications=n,e.insertBefore(n,o),t=cjgApis.session.account.displayName,cjgApis.session.account.pageId&&(t+="\n"+cjBasics.lang.i18n("cj_i18n_00363","Brand account")),cjgApis.session.account.displayEmail&&(t+="\n"+cjgApis.session.account.displayEmail),i=cjce.createElement("cjmd-iconbutton",{label:t,icon:{size:32,circle:!0,url:cjgApis.session.account.photoUrl+"?sz="+Math.ceil(32*window.devicePixelRatio),backupUrl:"/images/avatar.svg"},onClick:function(){w("accountchooser")}}),(L.accountchooser=i).classList.add("bm-p-portal-pageicon"),e.appendChild(i),cjgApis.info.getIsOne(g.account).then(function(e){e&&i.classList.add("bm-p-portal-accountbutton--one")})):((c=cjce.createElement("cjmd-button",{label:cjBasics.lang.i18n("cj_i18n_01544","Sign in"),fill:!0,color:!0,onClick:function(){cjgApis.account.signin(g.account)}})).classList.add("bm-p-portal-signin"),e.appendChild(c)),e}();n.appendChild(e),(f=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"transparentOnScroll"})).setAttribute("role","navigation"),f.addEventListener("click",function(e){var a=e.target.dataset.id;a&&(cjBasics.events.hasMeta(e)?E(g.servicesDatabase[a]):g.pageManager.navigate(a))}),f.addEventListener("mousedown",function(e){var a=e.target.dataset.id;a&&g.loadPage(a)}),f.addEventListener("auxclick",function(e){var a;1!==e.button||(a=e.target.dataset.id)&&(E(g.servicesDatabase[a]),e.preventDefault())}),f.addEventListener("keydown",function(e){if(!cjBasics.events.hasModifier(e)){var a=e.key,n=document.activeElement;if("ArrowUp"===a)(n.previousSibling||n.parentNode.lastChild).focus();else if("ArrowDown"===a)(n.nextSibling||n.parentNode.firstChild).focus();else{if("Enter"!==a&&" "!==a)return;n.click()}e.preventDefault()}}),g.userServices.onChange(function(e){var a="_"+e.join("_")+"_";h!==a&&(h=a,(v=e).forEach(function(e){var a=g.servicesDatabase[e].iconName,n=document.createElement("link");n.as="image",n.rel="preload",n.href="/images/48/"+a+"_48dp.svg",document.head.appendChild(n)}),M(),!t&&0<v.length&&(t=[].concat(v),function a(){window.requestIdleCallback&&window.requestIdleCallback(function(){var e;0!==t.length&&(e=t.shift(),g.requirePage(e).catch(function(){}).then(function(){0<t.length&&a()}))})}()))}),g.pageManager.onChange(function(e){if(e!==j){var a,n,t;(t=L[a=j])?t.classList.remove("cjmd-iconbutton--active"):(n=k[a])&&n.classList.remove("cjmd-item--selected"),-1===b.indexOf(e)&&(_=e);var i="customize"===(j=e)||"removedialog"===e;if(i!==C)C=i,M(),f.classList.toggle("bm-p-portal-pagelist--customize",C),function(e){if(!p)return;s.classList.toggle("bm-p-portal-customize--finish",e),d.hidden=e,l.hidden=!e,r||(p.textContent=e?u:m);e?(window.addEventListener("dragend",z),f.addEventListener("dragover",B),f.addEventListener("drop",N),f.addEventListener("dragstart",S)):(window.removeEventListener("dragend",z),f.removeEventListener("dragover",B),f.removeEventListener("drop",N),f.removeEventListener("dragstart",S))}(C);else{var c=L[e];if(c)return void c.classList.add("cjmd-iconbutton--active");var o=k[e];o&&(o.classList.add("cjmd-item--selected"),x(o))}}}),n.appendChild(f);var s=document.createElement("div");s.className="bm-p-portal-page bm-p-portal-customize";var r=Boolean(g.account.pageId);s.dataset.id=r?"accountchooser":"customize";var d=cjce.createElement("cjmd-icon",{name:r?"__mdi:account_circle":"__mdi:edit",color:g.darkMode?null:"#5f6368"});d.classList.add("bm-p-portal-customize__icon"),s.appendChild(d);var l=cjce.createElement("cjmd-icon",{name:"__mdi:done",color:g.darkMode?null:"#1a73e8"});l.hidden=!0,l.classList.add("bm-p-portal-customize__icon"),s.appendChild(l);var p=document.createElement("div"),m=cjBasics.lang.i18n("cj_i18n_01713","Customize"),a=cjBasics.lang.i18n("cj_i18n_01543","Switch account"),u=cjBasics.lang.i18n("cj_i18n_01715","Finish");p.textContent=r?a:m,p.className="bm-p-portal-customize__label",s.appendChild(p),s.addEventListener("click",function(){var e;r?g.pageManager.navigate("accountchooser"):(e=C?_:"customize",g.pageManager.navigate(e))}),n.appendChild(s),i&&i.commands&&i.commands.onCommand&&i.commands.onCommand.addListener&&i.commands.onCommand.addListener(function(e){"portal-next-page"===e?o(!1):"portal-previous-page"===e&&o(!0)})}()});