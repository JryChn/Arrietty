"use strict";cjce.registerTemplate("bm-p-collectionswebapp",function(m,u){var c="https://www.google.com",n=c+"/collections",e="0"===u.account.authuser?null:u.account.authuser,a=[];e&&a.push("authuser="+e),u.account.pageId&&a.push("pageId="+u.account.pageId);var t=a.length?"?"+a.join("&"):"",i="https://save-pa.googleapis.com/$rpc/google.search.platform.save.v2.SaveService/",_=!0,l={home:{id:"home",iconName:"__mdi:home",label:cjBasics.lang.i18n("cj_i18n_00291","Home"),shortcutId:"359",divider:!0},relatedHeader:{header:!0,color:!0,label:cjBasics.lang.i18n("cj_i18n_01539","Related apps")},search:{iconName:"__mdi:search",label:cjBasics.lang.i18n("cj_i18n_01365","Google Search"),shortcutId:"157"},maps:{label:cjBasics.lang.i18n("cj_i18n_01364","Google Maps"),iconName:"__mdi:place",shortcutId:"101"},shopping:{label:cjBasics.lang.i18n("cj_i18n_00059","Google Shopping"),iconName:"__mdi:local_offer",shortcutId:"129"},destinations:{label:cjBasics.lang.i18n("cj_i18n_01774","Travel Guide"),iconName:"__mdi:explore",shortcutId:"764"}};function o(e){S.cjceSendFrameCommand({method:"collectionswebappOpenCollection",value:e},c)}var p=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"save",serviceLabel:cjBasics.lang.i18n("cj_i18n_00432","Collections"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),bmApis:u,onNewTab:function(){S.cjceGetCleanUrl(c).then(function(e){var c=e||cjgShortcuts.getUrl("359",u.account);u.openTab(c)})},onBack:function(){o(null)}});m.appendChild(p);var s=p.cjceDrawerEl,r=cjce.createElement("bm-navlist",{selectedId:"home",items:l,onClick:function(e){"home"!==e&&u.pageManager.navigate(e)},onNewTab:function(e,c){var n=c.newTabUrl||cjgShortcuts.getUrl(c.shortcutId,u.account);u.openTab(n)}});s.appendChild(r);var d=!1;w().then(function(e){(d=0<e.length)&&(r.remove(),r=cjce.createElement("bm-navlist",{selectedId:"home",isSelector:!0,items:d?[l.home].concat(e):l,onChange:function(e){o("home"===e?null:e)},onNewTab:function(e){var c=n+("home"===e?"":"/list/"+e)+t;u.openTab(c)}}),s.appendChild(r))});var j=cjBasics.uniqueId.generate(),h=cjBasics.urlParams.attach(n,{bm_cid:"collectionswebapp",bm_iid:j,bm_wiz:"1",bm_cst:"1",authuser:e,pageId:u.account.pageId,hl:cjBasics.lang.current});function b(e,c,n){var a=c||{};a.alt="json",a.prettyPrint="false";var t=cjBasics.urlParams.attach(i+e,a);return cjgApis.request(t,{method:"POST",fetchAs:"json",headers:{"content-type":"application/json+protobuf"},body:JSON.stringify(n||[])},{account:u.account,pa:!0,key:window.atob("QUl6YVN5QnMtR0pFRHFCQW4wTmlFdjAzbmtXZ0NVVHIydmxhVmww")})}cjBasics.webRequest.handleIframeHeaders([c+"/*bm_iid="+j+"*"],{useMobileUserAgent:!0,handleFirefoxInject:!0});var g={IMAGE:"__mdi:image",ITINERARY:"__mdi:flight",JOB:"__mdi:work_outline",PLACE:"__mdi:place",RECIPE:"__mdi:restaurant",SHOPPING_PRODUCT:"__mdi:local_offer",SCREENSHOT:"__mdi:photo",TVM_ENTITY:"__mdi:play_circle_outline",WEB_PAGE:"__mdi:news"};function f(){return b("ListLists",{pageSize:"200",fields:"lists(listDescriptor(listId,itemTypes),displayName)"}).then(function(e){var i=[];return e.lists.forEach(function(e){var c,n,a=e.listDescriptor,t=a&&a.listId;t&&i.push({id:t,supportsAdditions:!Array.isArray(a.itemTypes)||-1!==a.itemTypes.indexOf("WEB_PAGE"),label:(c=e.displayName,(n=c||"").charAt(0).toUpperCase()+n.slice(1)),iconName:function(e){var c=e.listDescriptor&&e.listDescriptor.itemTypes;if(!Array.isArray(c))return"__mdi:bookmark_border";for(var n=0;n<c.length;n++){var a=g[c[n]];if(a)return a}return"__mdi:bookmark_border"}(e),newTabUrl:!0})}),i.sort(function(e,c){var n=e.label.toLowerCase(),a=c.label.toLowerCase();return n===a?e.id>c.id?1:-1:a<n?1:-1}),i}).catch(function(){return[]})}function v(){return cjgApis.cache.getItem(u.account,"bm_cache_v30__collections__lists").then(function(e){return Array.isArray(e)?e:[]})}function I(e){return cjgApis.cache.setItem(u.account,"bm_cache_v30__collections__lists",e),e}var C=null;function w(){return C=C||f().then(I,v)}function B(e){var n=cjce.createElement("cjmd-container",{solid:!0,floating:!0}),c=cjce.createElement("bm-ogb",{displayBack:!0,serviceIcon:"save",serviceLabel:cjBasics.lang.i18n("cj_i18n_00432","Collections"),pageLabel:cjBasics.lang.i18n("cj_i18n_06324","Save new item"),onBack:function(){n.remove()},bmApis:u});n.appendChild(c);var a=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"});n.appendChild(a);var t=document.createElement("div");t.className="bm-p-collections-form",a.appendChild(t);var i=cjce.createElement("cjmd-textfield",{floatingLabel:!0,label:cjBasics.lang.i18n("cj_i18n_06316","Name")});t.appendChild(i);var l=cjce.createElement("cjmd-textfield",{floatingLabel:!0,label:cjBasics.lang.i18n("cj_i18n_06317","Location (URL)")});t.appendChild(l);var o="_bm_choose_list";w().then(function(e){var c=[{value:"_bm_choose_list",label:cjBasics.lang.i18n("cj_i18n_06320","Add to collection")+"..."}];e.forEach(function(e){e.supportsAdditions&&c.push({value:e.id,label:e.label})});var n=cjce.createElement("cjmd-selectbox",{onChange:function(){o=n.selected},options:c});n.selected=o,t.appendChild(n)});var s=cjce.createElement("cjmd-button",{label:cjBasics.lang.i18n("cj_i18n_01363","Save"),fill:!0,color:!0,onClick:function(){var e,c;p.cjceSetLoading(!0),s.disabled=!0,s.textContent=cjBasics.lang.i18n("cj_i18n_06327","Saving"),S.src="about:blank",e={listId:"_bm_choose_list"!==o&&o||null,webPageUrl:l.cjceValue,title:i.cjceValue},c=[null,null,e.title||null,null,null,null,null,null,[e.webPageUrl||null]],b("AddItems",{fields:"listItems/title"},[null,e.listId?[e.listId]:[null,2,[5]],[c]]).then(function(){_=!0,S.src=h+"&",n.remove()})}});c.cjceAppendChild(s);var r=e&&e.title;r&&(i.cjceValue=r);var d=e&&e.bkmk;d&&(l.cjceValue=d),m.appendChild(n),setTimeout(function(){i.cjceSelect()})}var E,S=cjce.createElement("bm-iframe",{src:h,solid:"#fff",shadow:!0,onMessage:function(e){var c,n,a,t,i,l;"collectionswebappUpdatePath"===e.bm_method&&(n=-1!==(c=e.bm_value).indexOf("new-list"),a=-1!==c.indexOf("/list/"),p.cjceSetBackState(n||a),t="home",n?t="new-list":a&&(t=c.split("/list/")[1].split("/")[0]),r.cjceSelectedId=t,l=n?cjBasics.lang.i18n("cj_i18n_06321","New collection"):a?(i=d&&r.cjceGetItemElement(t))&&i.textContent||cjBasics.lang.i18n("cj_i18n_06322","Collection"):cjBasics.lang.i18n("cj_i18n_00291","Home"),p.cjceSetPageLabel(l))},onLoad:function(){_&&(_=!1,p.cjceSetLoading(!1))}});m.appendChild(S);var A=cjce.createElement("cjmd-fab",{mini:!0,color:!0,iconName:"__mdi:link",label:cjBasics.lang.i18n("cj_i18n_06323","Save this"),onClick:function(){B({bkmk:E.url,title:E.title})}});cjBasics.navigator.getActionableUrl().then(function(e){e?(E=e,A.title=cjBasics.lang.i18n("cj_i18n_06323","Save this")+" ("+E.url+")"):A.remove()});var T=cjce.createElement("cjmd-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_06324","Save new item"),onClick:function(){B()}}),A]});m.appendChild(T)});