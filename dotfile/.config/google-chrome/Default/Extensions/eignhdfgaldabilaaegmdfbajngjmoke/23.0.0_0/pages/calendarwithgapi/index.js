"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cjce.registerTemplate("bm-p-calendarwithgapi",function(c,l){var t="#1a73e8",a="#3f51b5",o=["https://www.googleapis.com/auth/calendar"],i=["https://www.googleapis.com/auth/reminders"],r=window.atob("QUl6YVN5Q0FmRFBsWlJMam1nSENKTnVpTVQ2UkNHVFBVVC1CU05F"),d="https://content.googleapis.com/calendar/v3/",s=cjBasics.lang.i18n("cj_i18n_00302","Calendar"),m="https://keep.google.com/"+l.wizPath,u="https://calendar.google.com",p=u+"/calendar/";"0"!==l.account.authuser&&(p+="b/"+l.account.authuser+"/");var h,f,g,_,n,b,v,j,C,w,y,S,T,E,B,N,k,L=p+"r",I=cjBasics.uniqueId.generate(),A=!1,D=!1,x=cjBasics.datetime.fullMonthNames,P=cjBasics.datetime.shortWeekdayNames,e=new Date,R=e.getFullYear(),U=e.getMonth(),M=e.getDate(),F=e.getDay(),O=e.getTime(),q=R+"_"+U.toString(16),H=864e5,V=31*H,z=O-V,W=O+V,Y=new Date(z).toISOString(),J=new Date(W).toISOString(),Q=!1,G=l.debugMode&&!0,K=[16,12,22,1,11,3,13,18,15,7,2],Z=["#16a765","#42d692","#4986e7","#7bd148","#92e1c0","#9a9cff","#9fc6e7","#9fe1e7","#a47ae2","#ac725e","#b3dc6c","#b99aff","#c2c2c2","#cabdbf","#cca6ac","#cd74e6","#d06b64","#f691b2","#f83a22","#fa573c","#fad165","#fbe983","#ff7537","#ffad46"],$=["#795548","#e67c73","#d50000","#f4511e","#ef6c00","#f09300","#00897b","#0b8043","#7cb342","#c0ca33","#e4c441","#f6bf26","#33b679","#039be5","#4285f4","#3f51b5","#7986cb","#b39ddb","#616161","#a79b8e","#ad1457","#d81b60","#8e24aa","#9e69af"];function X(){ce(N=!1),T.cjceSendFrameCommand({method:"calendarirenderShowEventClose"},u)}function ee(e,n){var t=document.createDocumentFragment(),a=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:edit",label:cjBasics.lang.i18n("cj_i18n_05629","Edit"),onClick:function(){ge(e||k,"edit")}});t.appendChild(a);var c=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:delete",label:cjBasics.lang.i18n("cj_i18n_01563","Delete"),onClick:function(){be(e||k).then(function(){n&&n.remove(),X()})}});t.appendChild(c);var i,r,o=(i=e,r=n,cjce.createElement("cjmd-iconbuttonmenu",{compact:!0,label:cjBasics.lang.i18n("cj_i18n_06294","More actions"),items:{duplicate:{iconName:"__mdi:content_copy",label:cjBasics.lang.i18n("cj_i18n_06293","Duplicate")},print:{iconName:"__mdi:print",label:cjBasics.lang.i18n("cj_i18n_02543","Print")}},onClick:function(e){"delete"===e?be(i||k).then(function(){r&&r.remove()}):ge(i||k,e)}}));return t.appendChild(o),t}function ne(e){var n,t,a;return"not_authorized"!==e.cjg_error||D||(D=!0,y&&(y.remove(),y.textContent="",y=null),cjgApis.cache.remove(l.account,"bm_cache_v30__calendar__eventlist"),n=cjce.createElement("cjmd-container",{shadow:"thin"}),t=cjBasics.lang.i18n("cj_i18n_00291","Home"),b.cjceSetPageLabel(t),j.hidden=!1,w.hidden=!0,C.hidden=!0,j.classList.remove("bm-p-calendarwithgapi-searchbox"),a=cjce.createElement("bm-fulldialog",{inline:!0,lockup:{label:s},iconName:"calendar",message:cjBasics.lang.i18n("cj_i18n_02176","Before you can use this page, you need to give access to load your __product_name__ data").replace("__product_name__",s),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(l.account,e.cjg_missing_scopes)}}),n.appendChild(a),c.appendChild(n)),Promise.reject(e)}function te(e,n){var t=n||{};t.prettyPrint="false";var a=cjBasics.urlParams.attach(d+e,t);return cjgApis.request(a,{fetchAs:"json"},{account:l.account,requiredScopes:o}).catch(ne)}function ae(e){n=new Intl.DateTimeFormat(cjBasics.lang.current,{timeStyle:"short",hour:"numeric",minute:"numeric",hour12:!e})}function ce(e){!1===e&&N&&(N=!1,b.cjceSetLoading(!0),setTimeout(Se,1e3)),e!==Q&&((Q=e)?setTimeout(function(){Q&&S.classList.remove("bm-p-calendarwithgapi-inlinerender--hidden")}):S.classList.add("bm-p-calendarwithgapi-inlinerender--hidden"))}function ie(){return te("users/me/calendarList",{maxResults:"250",fields:"items(backgroundColor,foregroundColor,id,selected,summary,colorId)"}).then(function(e){return e.items||[]},function(){return[]})}function re(e,n){if(e.allday!==n.allday)return e.allday?-1:1;if(e.start!==n.start)return e.start-n.start;if(e.isReminder!==n.isReminder)return e.isReminder?-1:1;var t=(e.title||"").toLowerCase(),a=(n.title||"").toLowerCase();return t!==a?t<a?-1:1:e.eventId<n.eventId?-1:1}function oe(e){return e?e.charAt(0).toUpperCase()+e.slice(1):cjBasics.lang.i18n("cj_i18n_01737","(No title)")}function de(){return cjgApis.cache.getItem(l.account,"bm_cache_v30__calendar__reminders").then(function(e){return Array.isArray(e)?e:[]})}function le(e){return cjgApis.cache.setItem(l.account,"bm_cache_v30__calendar__reminders",e),e}function se(e){return n.format(e).replace(" AM","am").replace(" PM","pm")}function me(){return e=W,n=z,t=cjBasics.urlParams.attach("https://reminders-pa.googleapis.com/v1internalOP/reminders/list",{fields:"task(dueDate,title,extensions,externalApplicationLink)",prettyPrint:"false"}),cjgApis.request(t,{method:"POST",fetchAs:"json",headers:{"Content-Type":"application/json"},body:JSON.stringify({includeDeleted:!1,includeArchived:!0,dueBeforeMs:e,dueAfterMs:n})},{pa:!0,key:r,account:l.account,requiredScopes:i}).then(function(e){return e.task.filter(function(e){return e&&e.dueDate&&e.dueDate.year})}).then(le,de).then(function(e){return e.map(function(e){var n=function(e){var n=e.dueDate,t=new Date;t.setFullYear(n.year),t.setMonth(n.month-1),t.setDate(n.day);var a=n.time;return a&&(t.setHours(a.hour),t.setMinutes(a.minute),t.setSeconds(a.second)),t}(e),t=n.getTime(),a=function(e){var n=e.extensions&&e.extensions.keepExtension&&e.extensions.keepExtension,t=n&&(n.serverNoteId||n.clientNoteId);if(t)return m+"#NOTE/"+t;var a=e.externalApplicationLink,c=a&&"keepReminder"===a.application&&a.id;return c?m+"?reminder="+c:void 0}(e);return{isReminder:!0,title:oe(e.title),keepNoteUrl:a,start:t,allday:e.dueDate.allDay,timeString:se(n)}})});var e,n,t}function ue(){var e,n,t=y.querySelector(".bm-p-calendarwithgapi-datebadge--selected");t&&(e=y.scrollTop,n=t.offsetTop-128,Math.abs(e-n)<50||(y.scrollTop=n))}function pe(){y&&(y.classList.remove("bm-p-calendarwithgapi-container--smoothscroll"),ue(),y.classList.add("bm-p-calendarwithgapi-container--smoothscroll"))}function he(e){var n=cjBasics.urlParams.attach(L+"/search",{q:e});l.openTab(n)}function fe(e){return window.btoa(e.eventId+" "+e.calendarId)}function ge(e,n){var t=fe(e),a=p,c={};"edit"===n?a+="r/eventedit/"+t:"duplicate"===n?a+="r/eventedit/duplicate/"+t:c="print"===n?(a+="printevent",{sf:"true",eid:t}):(a+="r/",{eid:t});var i=cjBasics.urlParams.attach(a,c);l.openTab(i)}function _e(){l.openTab(L+"/eventedit")}function be(e){var n=encodeURIComponent(e.calendarId),t=encodeURIComponent(e.eventId),a=d+"calendars/"+n+"/events/"+t;return cjgApis.request(a,{method:"DELETE"},{account:l.account,requiredScopes:o})}function ve(){var t=[],a=Promise.all([g,f]).then(function(e){return _?me(e[1]):[]}).then(function(e){t=t.concat(e)});return Promise.all([h,f]).then(function(e){var n=e[0].map(function(e){return!0!==e.selected?Promise.resolve():(p=e,te("calendars/"+encodeURIComponent(p.id)+"/events",{timeMin:Y,timeMax:J,maxResults:"2500",singleEvents:"true",fields:"items(id,end/dateTime,endTimeUnspecified,start(date,dateTime),summary,colorId)"}).then(function(e){return e.items.map(function(e){var n,t,a=new Date(e.start.dateTime||e.start.date+"T12:00:00Z"),c=a.getTime(),i="date"in e.start,r=null;i||(r=se(a),!e.endTimeUnspecified&&e.end&&e.end.dateTime&&(t=(n=new Date(e.end.dateTime)).getTime(),r+=" - "+se(new Date(e.end.dateTime)),H<t-c&&(r+=" ("+cjBasics.datetime.printDateString(n)+")")));var o,d=e&&e.colorId,l=p.colorId,s=p.backgroundColor,m=s&&-1===Z.indexOf(s);!m&&l&&(s=$[Number(l)-1]),d&&(o=s,s=$[K[Number(d)-1]]);var u=!d&&(!l||m)&&"#000000"===p.foregroundColor;return{calendarId:p.id,eventId:e.id,isReminder:!1,backgroundColor:s,sidestampColor:o,lightMode:u,title:oe(e.summary),start:c,allday:i,timeString:r}})},ne).catch(function(){return[]}).then(function(e){e&&(t=t.concat(e))}));var p});return n.push(a),Promise.all(n).then(function(){return t.sort(function(e,n){return e.start-n.start})})})}function je(t){var e=document.createElement("div");e.classList.add("bm-p-calendarwithgapi-eventlist__item");var n,a=oe(t.title),c=!t.allday;t.isReminder?(e.classList.add("bm-p-calendarwithgapi-eventlist__item--reminder"),c&&(a+=", "+t.timeString),(n=cjce.createElement("cjmd-icon",{theme:"solid",color:"#fff",name:"__mdi:reminders_alt",size:16})).classList.add("bm-p-calendarwithgapi-eventlist__remindericon"),e.appendChild(n)):c&&(a+="\n"+t.timeString),t.backgroundColor&&(e.style.backgroundColor=t.backgroundColor),t.sidestampColor&&(e.style.borderLeftColor=t.sidestampColor),t.lightMode&&e.classList.add("bm-p-calendarwithgapi-eventlist__item--light");var i,r,o,d=document.createElement("span");return d.classList.add("bm-p-calendarwithgapi-eventlist__label"),d.textContent=a,e.appendChild(d),t.isReminder||((i=document.createElement("div")).className="bm-p-calendarwithgapi-eventlist__tools",e.appendChild(i),r=ee(t,e),i.appendChild(r)),t.keepNoteUrl&&((i=document.createElement("div")).className="bm-p-calendarwithgapi-eventlist__tools",e.appendChild(i),o=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:drive_keep",label:cjBasics.lang.i18n("cj_i18n_06300","View related note in Keep"),onClick:function(){l.openTab(t.keepNoteUrl)}}),i.appendChild(o)),e.addEventListener("click",function(e){var n=e.target;n===i||i.contains(n)||(t.isReminder?t.keepNoteUrl&&l.openTab(t.keepNoteUrl):G?(N=!1,B=fe(k=t),T.cjceSendFrameCommand({method:"calendarirenderShowEventActivate",value:B},u),setTimeout(function(){ce(!(E.hidden=!1))})):ge(t))}),e}function Ce(e,n){return{fullName:x[n]+" "+e,month:n,dates:[]}}function we(e,n,t,a,c){return{weekdayName:P[a],dateNumber:t,events:[],isToday:c||!1}}function ye(e){var c,n,d,t,a;0!==e.length?(c=document.createDocumentFragment(),(n=e,d={},t=Ce(R,U),(d[q]=t).dates[M]=we(0,0,M,F,!0),n.forEach(function(e){var n=new Date(e.start),t=n.getFullYear(),a=n.getMonth(),c=n.getDate(),i=t+"_"+a.toString(16),r=d[i];r||(r=Ce(t,a),d[i]=r);var o=r.dates[c];o||(o=we(0,0,c,n.getDay(),!1),r.dates[c]=o),o.events.push(e)}),Object.keys(d).sort().map(function(e){return d[e]})).forEach(function(e,n){var t,a=document.createElement("div");a.className="bm-p-calendarwithgapi-monthlist",a.dataset.month=e.month,c.appendChild(a),0<n&&((t=document.createElement("div")).className="bm-p-calendarwithgapi-monthlist__header",t.textContent=e.fullName,a.appendChild(t)),e.dates.forEach(function(e){var n=function(e){var n=document.createElement("div");n.className="bm-p-calendarwithgapi-monthlist__item";var t=document.createElement("div");t.className="bm-p-calendarwithgapi-datebadge",n.appendChild(t),e.isToday&&t.classList.add("bm-p-calendarwithgapi-datebadge--selected");var a=document.createElement("div");a.className="bm-p-calendarwithgapi-datebadge__date",a.textContent=e.dateNumber,t.appendChild(a);var c=document.createElement("div");c.className="bm-p-calendarwithgapi-datebadge__weekday",c.textContent=e.weekdayName,t.appendChild(c);var i,r=document.createElement("div");return r.className="bm-p-calendarwithgapi-eventlist",n.appendChild(r),0===e.events.length?((i=document.createElement("div")).className="bm-p-calendarwithgapi-eventlist__noresults",i.textContent=e.isToday?cjBasics.lang.i18n("cj_i18n_00267","No events today"):cjBasics.lang.i18n("cj_i18n_06337","No events on this date"),r.appendChild(i)):e.events.sort(re).forEach(function(e){var n=je(e);r.appendChild(n)}),n}(e);a.appendChild(n)})}),y.textContent="",y.appendChild(c),setTimeout(function(){0===y.scrollTop?y.scrollTop=50:y.scrollTop+y.offsetHeight===y.scrollHeight&&(y.scrollTop-=50)},10)):y&&(y.textContent="",a=cjce.createElement("cjmd-emptystate",{iconName:"__mdi:event",label:cjBasics.lang.i18n("cj_i18n_00265","No events found"),subLabel:cjBasics.lang.i18n("cj_i18n_00266","To add a new event, click the red button in the bottom right corner")}),y.appendChild(a))}function Se(){return b.cjceSetLoading(!0),ve().then(function(e){A=!0,cjgApis.cache.setItem(l.account,"bm_cache_v30__calendar__eventlist",e),ye(e),b.cjceSetLoading(!1)})}function Te(i,e){var n,r=cjce.createElement("bm-navitem",{icon:{name:"__mdi:check_box",theme:"solid"},color:function(e){if(e.isRemindersCalendar)return a;var n=e.backgroundColor;return n&&-1===Z.indexOf(n)?n:e.colorId&&$[Number(e.colorId)-1]||n||t}(i),colorIcon:!0,label:i.summary,divider:e});return r.classList.add("bm-p-calendarwithgapi-draweritem"),r.addEventListener("click",function(e){var n,t,a,c=r.classList.toggle("bm-p-calendarwithgapi-draweritem--inactive");if(i.isRemindersCalendar)return _=!c,void browserStorage.sync.setItem("bm_pref__calendar__hidereminders",c).then(function(){Se().then(pe)});n=i.id,t=!c,a=d+"users/me/calendarList/"+encodeURIComponent(n)+"?fields=",cjgApis.request(a,{method:"PATCH",body:JSON.stringify({selected:t}),headers:{"Content-Type":"application/json"}},{account:l.account,requiredScopes:o}).catch(ne).then(function(){h=ie(),Se().then(pe)})}),i.selected||r.classList.add("bm-p-calendarwithgapi-draweritem--inactive"),i.isRemindersCalendar||((n=cjce.createElement("cjmd-iconbutton",{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_01254","Settings and sharing"),onClick:function(){var e;l.openTab(L+"/settings/calendar/"+(e=i.id,window.btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")))}})).classList.add("bm-p-calendarwithgapi-draweritem__settings"),r.appendChild(n)),r}function Ee(e){b.cjceSetNavigatorCollapseState(e),b.cjceSetBackState(e),j.hidden=!e,C.hidden=e,w.hidden=e}function Be(e){T.src=cjBasics.urlParams.attach(L,{bm_cid:"calendarirender",bm_iid:I,bm_wiz:"1",bm_cne:S.classList.contains("bm-p-calendarwithgapi-inlinerender--hidden")?null:"1",eid:B,hl:cjBasics.lang.current,bm_cfn:e})}function Ne(){var e,n="Lp",t=!1;cjBasics.webRequest.handleIframeHeaders([L+"*bm_iid="+I+"*"],{disableOgs:u,handleFirefoxInject:!0}),cjBasics.webRequest.catchAndStop(["https://contacts.google.com/widget/hovercard/*origin=https%3A%2F%2Fcalendar.google.com*"]),function(){(S=cjce.createElement("cjmd-container",{floating:!0,solid:!0})).classList.add("bm-p-calendarwithgapi-inlinerender","bm-p-calendarwithgapi-inlinerender--hidden"),cjce.applyTemplate(S,"bm-loading"),T=cjce.createElement("bm-iframe",{shadow:!0,sandbox:"allow-same-origin allow-scripts",onMessage:function(e){var n,t=e.bm_method,a=e.bm_value;"calendarirenderDialogClose"===t?ce(!1):"calendarirenderOpenUrlInNew"===t&&a.startsWith(u)&&(l.openTab(cjBasics.cleanBmUrl(a)),ce(!1),n=T.src,T.src="about:blank",setTimeout(function(){T.src=n}))},onLoad:function(){S.cjceSetLoading(!1)}});var e=cjce.createElement("bm-ogb",{displayBack:!0,bmApis:l,serviceLabel:s,pageLabel:cjBasics.lang.i18n("cj_i18n_00268","New event"),onBack:function(){ce(N=!1),T.cjceSendFrameCommand({method:"calendarirenderAddEventCancel"},u)}}),n=cjce.createElement("cjmd-button",{label:cjBasics.lang.i18n("cj_i18n_01363","Save"),fill:!0,color:!0,onClick:function(){ce(!(N=!0)),T.cjceSendFrameCommand({method:"calendarirenderAddEventSave"},u)}});e.cjceAppendChild(n),S.appendChild(e),(E=cjce.createElement("bm-ogb",{floating:!0,displayBack:!0,bmApis:l,serviceLabel:s,pageLabel:cjBasics.lang.i18n("cj_i18n_06291","Event details"),onBack:function(){X()}})).hidden=!0,S.appendChild(E);var t=ee(k);E.cjceAppendChild(t),S.appendChild(T),c.appendChild(S)}(),Be(n),e=cjBasics.urlParams.attach(L,{hl:cjBasics.lang.current,bm_iid:cjBasics.uniqueId.generate()}),cjBasics.ajax(e).then(function(e){var n=u+e.split('id="base-js" src="')[1].split('"')[0].replace("m=base","m=tWUEz").replace("/d=1","/d=0");return cjBasics.ajax(n)}).then(function(e){var n,t=e.match(/\.([[a-zA-Z$]{1,3})=function.+dow\.top\.loc/);return t&&(n=t[1],cjgApis.cache.setItem(l.account,"bm_cache_v30__calendar__renderfn",n)),n||null}).then(function(e){t=!0,e&&e!==n&&Be(n=e)}),cjgApis.cache.getItem(l.account,"bm_cache_v30__calendar__renderfn").then(function(e){t||e&&e!==n&&Be(n=e)})}!function(){var t,n,a;g=browserStorage.sync.getItem("bm_pref__calendar__hidereminders").then(function(e){_=!e}),h=ie(),t=!1,n=te("users/me/settings/format24HourTime",{fields:"value"}).then(function(e){t=!0;var n="object"!==_typeof(e)||"false"!==e.value&&!1!==e.value;return cjgApis.cache.setItem(l.account,"bm_cache_v30__calendar__24hours",n),ae(n),n},function(){return!0}),f=cjgApis.cache.getItem(l.account,"bm_cache_v30__calendar__24hours").then(function(e){return t||"boolean"!=typeof e?n:(ae(e),e)}),b=cjce.createElement("bm-ogb",{loading:!0,drawer:{keepOpenOnClick:!0},serviceIcon:"calendar",serviceLabel:s,pageLabel:x[U],searchbox:{collapsable:!0,onSubmit:he,submitInNewTab:!0},bmApis:l,onNewTab:function(){l.openTab(L)},onBack:function(){Ee(!1)}}),c.appendChild(b),v=b.cjceDrawerEl,(j=b.cjceSearchboxEl).hidden=!0,l.setOnPageDisplayHandler(j.select),w=cjce.createElement("cjmd-button",{hairline:!0,label:cjBasics.lang.i18n("cj_i18n_01253","Today"),onClick:ue}),b.cjceAppendChild(w),C=cjce.createElement("cjmd-iconbutton",{label:cjBasics.lang.i18n("cj_i18n_00085","Search"),iconName:"__mdi:search",onClick:function(){Ee(!0),j.select()}}),b.cjceAppendChild(C),(a=cjce.createElement("cjmd-container",{scrollable:!0,solid:!0,shadow:"thinOnScroll",onScrollTop:function(){z-=V,Y=new Date(z).toISOString(),Se()},onScrollBottom:function(){W+=V,J=new Date(W).toISOString(),Se()}})).addEventListener("scroll",function(){for(var e=a.querySelectorAll(".bm-p-calendarwithgapi-monthlist"),n=e[0].dataset.month||U,t=1;t<e.length&&!(a.scrollTop<e[t].offsetTop-68);t++)n=e[t].dataset.month;b.cjceSetPageLabel(x[n])}),y=a,c.appendChild(y),ae(),Se().then(pe),cjgApis.cache.getItem(l.account,"bm_cache_v30__calendar__eventlist").then(function(e){e&&0<e.length&&!A&&(ye(e),pe())}),function(){var c=cjce.createElement("cjmd-list");v.appendChild(c),Promise.all([h,g]).then(function(a){a[0].concat({isRemindersCalendar:!0,selected:_,summary:cjBasics.lang.i18n("cj_i18n_00081","Reminders")}).sort(function(e,n){return e.summary<n.summary?-1:1}).forEach(function(e,n){var t=Te(e,n===a[0].length);c.appendChild(t)}),c.lastChild.classList.add("cjmd-item--divider")});var e={trash:{iconName:"__mdi:delete",label:cjBasics.lang.i18n("cj_i18n_00005","Bin"),newTabUrl:L+"/trash",external:!0},settings:{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:L+"/settings",external:!0}},n=cjce.createElement("bm-navlist",{items:e,onNewTab:function(e,n){var t=n.newTabUrl||cjgShortcuts.getUrl(n.shortcutId,l.account);l.openTab(t)}});v.appendChild(n)}();var e=cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_00268","New event"),onClick:function(){N=!(B=null),T.cjceSendFrameCommand({method:"calendarirenderAddEventActivate"},u),setTimeout(function(){ce(E.hidden=!0)})},onMetaClick:_e});c.appendChild(e),Ne()}()});