"use strict";cjce.registerTemplate("bm-p-sites",function(t,d){var a,c,i,r="my",l=window.location.origin,u="https://sites.google.com",n=u+"/site/sites/system/app/pages/meta/",s={my:{label:cjBasics.lang.i18n("cj_i18n_00054","My sites"),iconName:"__mdi:drive_site",shortcutId:"130"},trash:{label:cjBasics.lang.i18n("cj_i18n_00113","Deleted sites"),iconName:"__mdi:delete",newTabUrl:n+"dashboard/deleted?authuser="+d.account.authuser,divider:!0},atari:{label:cjBasics.lang.i18n("cj_i18n_00112","Sites"),iconName:"__mdi:atari_site",color:"#3f51b5",colorIcon:!0,shortcutId:"504"}};function o(e){var t=cjBasics.urlParams.attach(n+"search",{scope:"my",q:e,authuser:d.account.authuser});d.openTab(t)}function m(){var n=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:"my",items:s,onChange:function(e){if("atari"===e)return d.pageManager.navigate("atari"),void(n.cjceSelectedId=r);var t,a;a=s[r=t=e].label,i.cjceSetPageLabel(a),h(t)},onNewTab:function(e,t){var a=t.newTabUrl||cjgShortcuts.getUrl(t.shortcutId,d.account);d.openTab(a)}});c.appendChild(n)}function h(e){a.textContent="";var c=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"thinOnScroll"});cjce.applyTemplate(c,"bm-loading",{state:!0}),a.appendChild(c);var i="trash"===e,t=i?p("dashboard/deleted").then(function(e){if(-1===e.indexOf('<ul id="sites-dashboard-list-mobile">'))return[];var t=e.replace(/onclick/g,"data-click").split('<ul id="sites-dashboard-list-mobile">')[1].split("</ul>")[0],a=(new window.DOMParser).parseFromString(t,"text/html").body.children;if(0===a.length||!a[0]||!a[0].querySelector(".sites-dashboard-list-mobile-name"))return[];for(var n=[],c=0;c<a.length;c++){var i=a[c],r=i.querySelector("a").dataset.click.split("'")[1].split("'")[0],l=i.querySelector(".sites-dashboard-list-mobile-name").textContent,s=u+"/site/"+r+"?authuser="+d.account.authuser,o="Deleted by"+i.querySelector("div:nth-child(2)").textContent.split(":")[1]+" on"+i.querySelector("div:nth-child(3)").textContent.split(":")[1];n.push({url:s,primaryText:l,secondaryText:o,tertiaryText:"/site/"+r})}return n}):p("dashboard").then(function(e){if(-1===e.indexOf("<ul>"))return[];var t=e.split("<ul>")[1].split("</ul>")[0],a=(new window.DOMParser).parseFromString(t,"text/html").body.children;if(0===a.length||!a[0]||!a[0].querySelector(".your-site-title"))return[];for(var n=[],c=0;c<a.length;c++){var i=a[c],r={url:u+i.querySelector(".your-site-title").href.replace(l,"")+"?authuser="+d.account.authuser,primaryText:i.querySelector(".your-site-title").textContent,secondaryText:i.querySelector(".sites-dash-site-url").textContent};i.querySelector(".wiki_summarized")&&(r.tertiaryText=i.querySelector(".wiki_summarized").textContent),n.push(r)}return n});t.then(function(e){var t,a,n;0===e.length?(n=i,t=cjce.createElement("cjmd-emptystate",{label:cjBasics.lang.i18n("cj_i18n_00055","No sites found"),subLabel:n?null:cjBasics.lang.i18n("cj_i18n_00114","To add a new site, click the add button"),iconName:"__mdi:drive_site"}),c.appendChild(t)):(a=cjce.createElement("cjmd-list"),e.forEach(function(e){var t=function(e){var t=cjce.createElement("cjmd-item",{multiline:!0});t.addEventListener("click",function(){d.openTab(e.url)});var a=cjce.createElement("cjmd-icon",{favicon:e.url});t.appendChild(a);var n=document.createElement("div");n.className="cjmd-item__body",t.appendChild(n);var c=document.createElement("div");c.className="cjmd-item__header",c.textContent=e.primaryText,n.appendChild(c);var i,r=document.createElement("div");return r.className="cjmd-secondarytext",r.textContent=e.secondaryText,n.appendChild(r),e.tertiaryText&&((i=document.createElement("div")).className="cjmd-secondarytext",i.textContent=e.tertiaryText,n.appendChild(i)),t}(e);a.appendChild(t)}),c.appendChild(a)),cjce.applyTemplate(c,"bm-loading",{state:!1})})}function p(e){var t=cjBasics.urlParams.attach(n+e,{mobile:"true",hl:"en",authuser:d.account.authuser});return cjBasics.ajax(t)}!function(){i=cjce.createElement("bm-ogb",{drawer:!0,serviceIcon:"sites",serviceLabel:cjBasics.lang.i18n("cj_i18n_00111","Classic Sites"),pageLabel:cjBasics.lang.i18n("cj_i18n_00054","My sites"),searchbox:{onSubmit:o,submitInNewTab:!0},bmApis:d,onNewTab:function(){var e=s[r].newTabUrl;d.openTab(e)}}),t.appendChild(i),c=i.cjceDrawerEl,m(),d.setOnPageDisplayHandler(i.cjceSearchboxEl.select);var e=cjce.createElement("cjmd-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_00115","Create new site"),onClick:function(){var e=n+"dashboard/create-new-site?authuser="+d.account.authuser;d.openTab(e)}}),cjce.createElement("cjmd-fab",{mini:!0,color:"#3f51b5",iconName:"__mdi:atari_site",label:cjBasics.lang.i18n("cj_i18n_00115","Create new site"),onClick:function(){var e=u+"/create?authuser="+d.account.authuser;d.openTab(e)}})]});t.appendChild(e),a=cjce.createElement("cjmd-container"),t.appendChild(a),h(r)}()});