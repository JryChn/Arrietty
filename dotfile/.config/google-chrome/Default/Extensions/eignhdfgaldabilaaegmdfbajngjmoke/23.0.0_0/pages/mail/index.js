"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cjce.registerTemplate("bm-p-mail",function(o,s){var n="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,l="inbox"===(s.instanceParameters.productId||"mail");cjce.applyTemplate(o,"bm-loading"),l&&o.classList.add("bm-p-mail--bigtop"),o.classList.add("bm-p-mail--inboxview");var i,c,t,r,d,m,u,_,b,p,h,j,g,f,A,v,B=["https://www.googleapis.com/auth/gmail.labels"],S="https://content.googleapis.com/gmail/v1/",I="https://accounts.google.com",a="https://mail.google.com",y=a+"/mail/u/"+s.account.authuser+"/",T=a+"/mail/mu/mp/",E=y+"#",L=E+"label/",N=l?"inbox":"googlemail",w=l?cjBasics.lang.i18n("cj_i18n_00421","Inbox"):cjBasics.lang.i18n("cj_i18n_00416","Gmail"),R=l?"#1a73e8":"#ea4335",k="bm_cache_v30__mail__sessionid",C=l?"tl/priority/":"",P="INBOX",U=!1,H=!1,M=["SMARTLABEL_TRAVEL","SV_I","SMARTLABEL_RECEIPT","SMARTLABEL_FINANCE","SMARTLABEL_SOCIAL","SMARTLABEL_PURE_NOTIF","SMARTLABEL_GROUP","SMARTLABEL_PROMO","IO_UNIM"],O=M.concat(["SNOOZED","DONE","REMINDERS","CHAT","ALL"]),x=l?["INBOX","SNOOZED","DONE","DRAFT","SENT","REMINDERS","TRASH","SPAM"]:["INBOX","STARRED","SNOOZED","IMPORTANT","CHAT","SENT","DRAFT","ALL","SPAM","TRASH"],e='div[style*="translate3d"] div[role="button"]',D="bm_mail_"+(l?"bigtop":"gmail")+"__"+s.account.authuser+"_"+window.btoa(s.account.obfuscatedId).replace(/=+/,""),q="GMAIL_AT",F=["requestHeaders"];cjBasics.webRequest.extraHeadersSupported&&F.push("extraHeaders");var W,X="",z=a+"/mail/mu/*mui="+D+"*",G=["^smartlabel_personal","^smartlabel_social","^smartlabel_promo","^smartlabel_notification","^smartlabel_group"],V={"^smartlabel_personal":{label:cjBasics.lang.i18n("cj_i18n_00178","Primary"),color:"#ea4335"},"^smartlabel_social":{label:cjBasics.lang.i18n("cj_i18n_00312","Social"),color:"#4285f4"},"^smartlabel_promo":{label:cjBasics.lang.i18n("cj_i18n_00315","Promos"),color:"#1e8e3e"},"^smartlabel_notification":{label:cjBasics.lang.i18n("cj_i18n_00313","Updates"),color:"#fa7b17"},"^smartlabel_group":{label:cjBasics.lang.i18n("cj_i18n_00182","Forums"),color:"#a142f4"},"^io_im,PI":{label:cjBasics.lang.i18n("cj_i18n_00184","Important")},"^u,PI":{label:cjBasics.lang.i18n("cj_i18n_01559","Unread")},"^t,PI":{label:cjBasics.lang.i18n("cj_i18n_00004","Starred")},"^io_im,^u,PI":{label:cjBasics.lang.i18n("cj_i18n_01560","Important & unread")},"^all,^f,PI":{label:cjBasics.lang.i18n("cj_i18n_00303","Sent")},"^all,^r,PI":{label:cjBasics.lang.i18n("cj_i18n_00187","Drafts")},",PI":{label:cjBasics.lang.i18n("cj_i18n_00331","Everything")}},Z={"^all":"ALL","^f":"SENT","^i":"INBOX","^io_im":"IMPORTANT","^k":"TRASH","^r":"DRAFT","^s":"SPAM","^t":"STARRED"},J={INBOX:{label:cjBasics.lang.i18n("cj_i18n_00299","Inbox"),newTabUrl:E,superpuduHash:l?"tl/priority/":"tl/please_redirect_me_google",iconName:"__mdi:inbox",color:R,colorIcon:l},PINNED:{superpuduHash:"tl/search/label%3Apinned"},STARRED:{label:cjBasics.lang.i18n("cj_i18n_00004","Starred"),newTabUrl:E+"starred",superpuduHash:"tl/Starred",iconName:"__mdi:star_outline"},SNOOZED:{label:cjBasics.lang.i18n("cj_i18n_00300","Snoozed"),newTabUrl:E+"snoozed",superpuduHash:"tl/search/in%3Asnoozed",iconName:l?"__mdi:schedule":"__mdi:watch_later",color:l?"#ef6c00":null,colorIcon:l},DONE:{label:cjBasics.lang.i18n("cj_i18n_00301","Done"),newTabUrl:E+"done",superpuduHash:"tl/search/label%3Adone",iconName:"__mdi:bigtop_done",color:"#34a853",colorIcon:!0,divider:l},IMPORTANT:{label:cjBasics.lang.i18n("cj_i18n_00184","Important"),newTabUrl:E+"imp",superpuduHash:"tl/Important",iconName:"__mdi:label_important_outline"},CHAT:{label:cjBasics.lang.i18n("cj_i18n_00185","Chats"),newTabUrl:E+"chats",superpuduHash:"tl/Chats",iconName:"__mdi:--hangout"},SENT:{label:cjBasics.lang.i18n("cj_i18n_00303","Sent"),newTabUrl:E+"sent",superpuduHash:"tl/Sent%20Mail",iconName:"__mdi:send"},REMINDERS:{label:cjBasics.lang.i18n("cj_i18n_00081","Reminders"),newTabUrl:E+"reminders",superpuduHash:"tl/Reminders",iconName:"__mdi:reminder"},DRAFT:{label:cjBasics.lang.i18n("cj_i18n_00187","Drafts"),newTabUrl:E+"drafts",superpuduHash:"tl/Drafts",iconName:l?"__mdi:drafts":"__mdi:insert_drive_file"},ALL:{label:cjBasics.lang.i18n("cj_i18n_00188","All mail"),newTabUrl:E+"all",superpuduHash:"tl/All%20Mail",iconName:"__mdi:stacked_email"},SPAM:{label:cjBasics.lang.i18n("cj_i18n_00306","Spam"),newTabUrl:E+"spam",superpuduHash:"tl/Spam",iconName:"__mdi:report",divider:l},TRASH:{label:cjBasics.lang.i18n("cj_i18n_00005","Bin"),newTabUrl:E+"trash",superpuduHash:"tl/Trash",iconName:"__mdi:delete"},SMARTLABEL_TRAVEL:{label:cjBasics.lang.i18n("cj_i18n_00308","Travel"),iconName:"__mdi:travel",newTabUrl:E+"trips",superpuduHash:"tl/search/category%3Atravel",color:"#9c27b0",colorIcon:!0},SV_I:{label:cjBasics.lang.i18n("cj_i18n_00309","Saved"),iconName:"__mdi:bookmark_border",superpuduHash:"tl/search/label%3Asaved",color:"#4285f4",colorIcon:!0},SMARTLABEL_RECEIPT:{label:cjBasics.lang.i18n("cj_i18n_00310","Purchases"),iconName:"__mdi:shopping_cart",superpuduHash:"tl/search/category%3Apurchases",color:"#795548",colorIcon:!0},SMARTLABEL_FINANCE:{label:cjBasics.lang.i18n("cj_i18n_00311","Finance"),iconName:"__mdi:trending_up",gmailPath:"search/category%3Afinance",superpuduHash:"tl/search/category%3Afinance",color:"#689f38",colorIcon:!0},SMARTLABEL_SOCIAL:{label:cjBasics.lang.i18n("cj_i18n_00312","Social"),iconName:"__mdi:people",superpuduHash:"tl/search/category%3Asocial",color:"#ea4335",colorIcon:!0},SMARTLABEL_PURE_NOTIF:{label:cjBasics.lang.i18n("cj_i18n_00313","Updates"),iconName:"__mdi:flag",superpuduHash:"tl/search/category%3Aupdates",color:"#ff6839",colorIcon:!0},SMARTLABEL_GROUP:{label:cjBasics.lang.i18n("cj_i18n_00182","Forums"),iconName:"__mdi:question_answer",superpuduHash:"tl/search/category%3Aforums",color:"#3f51b5",colorIcon:!0},SMARTLABEL_PROMO:{label:cjBasics.lang.i18n("cj_i18n_00315","Promos"),iconName:"__mdi:local_offer",superpuduHash:"tl/search/category%3Apromotions",color:"#00bcd4",colorIcon:!0},IO_UNIM:{label:cjBasics.lang.i18n("cj_i18n_00316","Low Priority"),iconName:"__mdi:low_priority",superpuduHash:"tl/search/label%3Alowpriority"}},K={apply:cjBasics.lang.i18n("cj_i18n_01567","Apply"),archive:l?cjBasics.lang.i18n("cj_i18n_01734","Mark done"):cjBasics.lang.i18n("cj_i18n_01579","Archive"),delete:cjBasics.lang.i18n("cj_i18n_01563","Delete"),deleteForever:cjBasics.lang.i18n("cj_i18n_01577","Delete forever"),label:cjBasics.lang.i18n("cj_i18n_01571","Label..."),markUnread:cjBasics.lang.i18n("cj_i18n_01573","Mark as unread"),more:cjBasics.lang.i18n("cj_i18n_00047","More"),move:cjBasics.lang.i18n("cj_i18n_01570","Move..."),moveToInbox:cjBasics.lang.i18n("cj_i18n_01575","Move to inbox"),notSpam:cjBasics.lang.i18n("cj_i18n_01576","Not spam"),reportSpam:cjBasics.lang.i18n("cj_i18n_01572","Report spam"),openInNew:cjBasics.lang.i18n("cj_i18n_01545","Open in a new tab"),send:cjBasics.lang.i18n("cj_i18n_01565","Send")},Q={archive:l?"__mdi:bigtop_done":"__mdi:archive",openInNew:"__mdi:open_in_new",delete:"__mdi:delete",deleteForever:"__mdi:delete_forever",label:"__mdi:label",markUnread:"__mdi:email",more:"__mdi:more_vert",move:"__mdi:drive_file_move",moveToInbox:"__mdi:move_to_inbox",notSpam:"__mdi:report_off",reportSpam:"__mdi:report",send:"__mdi:send"};function Y(){var e=C.split("/"),a=e[e.length-1],n=cjBasics.numbers.hex2dec(a),i=cjgApis.url.gmailThread.encode({threadId:n,messageId:n}),c="all";C.startsWith("cv/Draft")?c="drafts":C.startsWith("cv/Trash")?c="trash":C.startsWith("cv/Spam")&&(c="spam");var t=E+c+"/"+i;s.openTab(t)}function $(){s.openTab(y+"?view=cm&fs=1&tf=1")}var ee=null,ae={ad:{onBackAction:['#adstopbar [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01564","Ad"),mainActions:[["button","delete",['#adstopbar [role="button"]',1]]]},co:{onBackAction:['#cvtbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_00317","Compose"),mainActions:[["fillbutton","send",['#cvtbt [role="button"]',1]]]},"lb-label":{onBackAction:['#lbttb [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01566","Label"),mainActions:[["fillbutton","apply",['#lbttb [role="button"]',1]]]},"lb-move":{onBackAction:['#lbttb [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01568","Move")},cv:{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01569","Thread"),mainActions:[["iconbutton","archive",[e]],["iconbutton","delete",[e,1]],["iconbutton","openInNew",Y]],secondaryActions:{move:[e,3,2],label:[e,4,2],reportSpam:[e,6,2],markUnread:[e,8,2]}},"cv-draft":{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01574","Draft"),mainActions:[["iconbutton","archive",[e]],["iconbutton","delete",[e,1]],["iconbutton","openInNew",Y]],secondaryActions:{moveToInbox:[e,3,2],label:[e,4,2],markUnread:[e,6,2]}},"cv-spam":{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01569","Thread"),mainActions:[["button","notSpam",[e]],["iconbutton","openInNew",Y]],secondaryActions:{deleteForever:[e,2,1],label:[e,3,1],markUnread:[e,5,1]}},"cv-trash":{onBackAction:['#cv__cntbt [role="button"]'],label:cjBasics.lang.i18n("cj_i18n_01569","Thread"),mainActions:[["button","deleteForever",[e]],["iconbutton","openInNew",Y]],secondaryActions:{moveToInbox:[e,2,1],label:[e,3,1],reportSpam:[e,4,1],markUnread:[e,6,1]}},"tl-selection":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["iconbutton","archive",[e]],["iconbutton","delete",[e,1]]],secondaryActions:{move:[e,3,2],label:[e,4,2],reportSpam:[e,6,2],markUnread:[e,7,2]}},"tl-selection-all":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["button","moveToInbox",[e]]],secondaryActions:{archive:[e,2,1],delete:[e,3,1],label:[e,4,1],reportSpam:[e,5,1],markUnread:[e,6,1]}},"tl-selection-draft":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["iconbutton","archive",[e,0]],["iconbutton","delete",[e,1]]],secondaryActions:{moveToInbox:[e,3,2],label:[e,4,2],markUnread:[e,5,2]}},"tl-selection-spam":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["button","notSpam",[e]]],secondaryActions:{deleteForever:[e,2,1],label:[e,3,1],markUnread:[e,4,1]}},"tl-selection-trash":{onBackAction:[e,-1],label:cjBasics.lang.i18n("cj_i18n_01578","Selection"),mainActions:[["button","deleteForever",[e]]],secondaryActions:{moveToInbox:[e,2,1],label:[e,3,1],reportSpam:[e,4,1],markUnread:[e,5,1]}}};function ne(a){var e=a.onBack;Array.isArray(a.onBackAction)&&(e=function(){he(a.onBackAction)});var r=cjce.createElement("bm-ogb",{displayBack:!0,floating:!0,serviceLabel:w,pageLabel:a.label,onBack:e});if(Array.isArray(a.mainActions)&&a.mainActions.forEach(function(e){var a,n,i,c,t,o,l=(a=e[0],n=e[1],i=e[2],c=Q[n],t={label:K[n],onClick:function(e){"move"===n?H=!0:"label"===n&&(H=!1),"function"!=typeof i?he(i):i(e)}},o="cjmd-button","iconbutton"===a?(o="cjmd-iconbutton",t.iconName=c):(t.color=!0,t.hairline="fillbutton"!==a,t.fill="fillbutton"===a),cjce.createElement(o,t));r.cjceAppendChild(l)}),a.secondaryActions){var n={};for(var i in a.secondaryActions)Array.isArray(a.secondaryActions[i])&&(n[i]={label:K[i],iconName:Q[i]});var c=cjce.createElement("cjmd-iconbuttonmenu",{label:cjBasics.lang.i18n("cj_i18n_06294","More actions"),items:n,onClick:function(e){"move"===e?H=!0:"label"===e&&(H=!1),he(a.secondaryActions[e])}});r.cjceAppendChild(c)}return a.additionalFragment&&r.cjceAppendChild(a.additionalFragment),r}function ie(e){var a;ee&&ae[ee]&&ae[ee].toolbar&&(ae[ee].toolbar.hidden=!0),(ee=e)&&((a=ae[e]).toolbar?a.toolbar.hidden=!1:(a.toolbar=ne(a),o.appendChild(a.toolbar)))}function ce(){var e=C.startsWith("tl")&&!i,a=!C||e&&("tl/"===C||"tl/Inbox"===C||C.startsWith("tl/priority")||"tl/search/label%3Apinned"===C);o.classList.toggle("bm-p-mail--inboxview",a),C.startsWith("mn")?(pe("tl"),ie()):C.startsWith("er")||C.startsWith("pr")?(ie(),pe("tl")):C.startsWith("co")?ie("co"):C.startsWith("ad")?ie("ad"):C.startsWith("cv/Draft")?ie("cv-draft"):C.startsWith("cv/Spam")?ie("cv-spam"):C.startsWith("cv/Trash")?ie("cv-trash"):C.startsWith("cv")?ie("cv"):C.startsWith("lb")?ie(H?"lb-move":"lb-label"):ie(),t&&(t.hidden=!e)}function te(e,a){var n=a||{};n.prettyPrint="false";var i=cjBasics.urlParams.attach(S+"users/me/"+e,n);return cjgApis.request(i,{fetchAs:"json"},{account:s.account,requiredScopes:B})}function oe(e){return-1===O.indexOf(e.id)}function le(){return te("labels",{fields:"labels(id,name,type)"}).then(function(e){var a=e&&e.labels||[],n=a.filter(oe).map(function(a){return te("labels/"+a.id,{fields:"threadsUnread"}).then(function(e){return e&&e.threadsUnread||null},function(){return null}).then(function(e){a.unreadCount=e})});return Promise.all(n).then(function(){return cjgApis.cache.setItem(s.account,"bm_cache_v30__mail__apilabels",a),a})},function(e){if(e&&"not_authorized"===e.cjg_error)return"not_authorized"})}function re(e,n){e.forEach(function(e){var a=J[e];a.id=e,n.push(a)})}function se(c){var n,i,e="not_authorized"!==c,a=c,t=[];return re(x,t),Array.isArray(a)&&(t.forEach(function(e){for(var a,n=0;n<c.length;n++)if(c[n].id===e.id){var i="string"!=typeof(a=c[n].unreadCount)&&"number"!=typeof a||"0"===a.toString()?null:a;i&&(e.infoSuffix=i);break}}),n=[],i=l?"__mdi:stacked_email":"__mdi:label",a.forEach(function(e){var a;"system"!==e.type&&(a=!l&&e.color&&e.color.backgroundColor,J.TRASH.divider=!l,n.push({id:e.id,newTabUrl:l?null:L+e.name,label:e.name,iconName:i,infoSuffix:e.infoSuffix,color:a,colorIcon:Boolean(a),superpuduHash:"tl/"+e.name.toLowerCase().replace(/ |\//g,"-")}))}),n.sort(function(e,a){return e.label>a.label?1:-1}),t=t.concat(n)),e||(J[l?"IO_UNIM":"TRASH"].divider=!0),l&&re(M,t),{labels:t,authorized:e}}function de(e){return cjce.createElement("bm-navlist",{compact:!0,isSelector:!0,selectedId:P,items:e,onChange:function(e,a){"REMINDERS"===(P=e)?j?j.hidden=!1:((j=cjce.createElement("cjmd-container")).classList.add("bm-p-mail-sheet","bm-p-mail-reminders"),cjce.applyTemplate(_,"bm-loadingbar"),o.appendChild(j),s.requirePage("reminders").then(function(){var e=cjce.createElement("bm-p-reminders__reminderslist",{bmApis:s,onLoadChange:function(e){_.cjceSetLoading(e)}});j.appendChild(e)})):(pe(a.superpuduHash),j&&(j.hidden=!0)),_.cjceSetPageLabel(a.label),"INBOX"!==e&&o.classList.remove("bm-p-mail--inboxview"),l?(u.style.color=a.colorIcon?a.color:"",b.classList.remove("bm-p-mail-pintoggle--selected")):p&&(p.cjceSelectedId=f,A=f,ue()),"INBOX"===e&&o.classList.add("bm-p-mail--inboxview")},onNewTab:function(e,a){s.openTab(a.newTabUrl)}})}function me(e){return"tl/priority/"+encodeURIComponent(e.replace(",PI",""))}function ue(){var e,a=A&&c[A];a&&(e=a.color,p.style.setProperty("--accent-color",e))}function _e(e){if(!l&&h){if(e.length<2)return h.hidden=!0,void(h.textContent="");f=e[0],J.INBOX.superpuduHash=me(f),c={},e.forEach(function(e){c[e]=V[e]}),p=cjce.createElement("cjmd-tabs",{color:R,items:c,onChange:function(e){A=e,ue(),pe(me(e))},selectedId:A||f}),h.textContent="",1<e.length&&(h.hidden=!1),h.appendChild(p),ue()}}function be(e,a){var n,i,c,t=se(e);JSON.stringify(v)!==JSON.stringify(t.labels)&&(v=t.labels,n=d.contains(document.activeElement)&&d.classList.contains("cjmd-sheet--open"),i=m,m=de(t.labels),cjce.replaceChild(d,m,i),n&&d.cjceToggleState(!0),a&&!t.authorized&&(c=cjce.createElement("bm-inlinepermission",{description:cjBasics.lang.i18n("cj_i18n_01155","To list your labels and give you unread counts, please grant read-only access to your labels and unread count"),onClick:function(){cjgApis.auth.requestPermissions(s.account,B)}}),d.appendChild(c)))}function pe(e){r.src=W.split("#")[0]+"#"+e,C=e,ce()}function he(e){r.cjceSendFrameCommand({method:"mailClickEle",value:e},a)}!function(){var a;_=cjce.createElement("bm-ogb",{drawer:{color:"#212121"},serviceIcon:N,serviceLabel:w,pageLabel:cjBasics.lang.i18n("cj_i18n_00299","Inbox"),searchbox:{onClear:function(){i="",t.hidden=!1,o.classList.add("bm-p-mail--inboxview"),he(['#tltbt [role="button"]'])},onSubmit:function(e){i=e,j&&(j.hidden=!0),t.hidden=!0,o.classList.remove("bm-p-mail--inboxview"),pe("tl/search/"+e)}},bmApis:s,onNewTab:function(){var a,n;i?s.openTab(E+"search/"+i):(a=!1,n=m&&m.cjceSelectedId,v&&n&&v.forEach(function(e){e.id===n&&(s.openTab(e.newTabUrl),a=!0)}),a||s.openTab(E))}}),o.appendChild(_),l?((a=document.createElement("div")).className="bm-p-mail-pintoggle",a.title=cjBasics.lang.i18n("cj_i18n_01580","Pinned"),a.addEventListener("click",function(){var e=a.classList.toggle("bm-p-mail-pintoggle--selected");_.cjceSetPageLabel(e?cjBasics.lang.i18n("cj_i18n_01580","Pinned"):cjBasics.lang.i18n("cj_i18n_00299","Inbox")),pe(J[e?"PINNED":"INBOX"].superpuduHash)}),b=a,_.cjceAppendChild(b)):((h=cjce.createElement("cjmd-appbar",{secondary:!0})).classList.add("bm-p-mail-prioritytabs"),_.appendChild(h)),u=_.querySelector(".cjmd-navigator"),l&&u&&(u.style.color="#1a73e8"),(d=_.cjceDrawerEl).classList.add("bm-p-mail-drawer");var e=_.cjceSearchboxEl;e.classList.add("bm-p-mail-searchbox"),s.setOnPageDisplayHandler(e.select),cjBasics.webRequest.handleIframeHeaders([z],{handleFirefoxInject:!0}),cjBasics.webRequest.handleIframeHeaders([I+"/*"+z,I+"/*"+encodeURIComponent(z)]),n.cookies.get({url:y,name:q},function(e){e&&!X&&(X=e.value)}),cjBasics.webRequest.addListener("onBeforeSendHeaders",function(e){for(var a=e.requestHeaders,n=0;n<a.length;n++){var i=a[n];if("cookie"===i.name.toLowerCase()){var c=i.value;-1!==c.indexOf(q)&&(X=c.split(q+"=")[1].split(";")[0]);break}}},{urls:[y+"s/*at=*"],types:["xmlhttprequest"]},F),cjBasics.webRequest.addListener("onBeforeRequest",function(e){return{redirectUrl:e.url.replace("at="+D,"at="+X)}},{urls:[y+"s/*at="+D+"*"],types:["xmlhttprequest"]},["blocking"]),cjBasics.webRequest.addListener("onBeforeRequest",function(e){return{redirectUrl:e.url.replace("at="+D,"at="+X)}},{urls:[y+"photos/*at="+D+"*"],types:["image"]},["blocking"]),cjgApis.cache.getItem(s.account,k).then(function(e){var a=T+(e?e+"/":"");e&&n.cookies.get({url:a,name:q},function(e){e&&(X=e.value)}),W=cjBasics.urlParams.attach(a,{mui:D,hl:"en",authuser:s.account.authuser}),r=cjce.createElement("bm-iframe",{sandbox:"allow-scripts allow-same-origin allow-popups",src:W+"#"+C,solid:"#fff",shadow:!0,onLoad:function(){o.cjceSetLoading(!1)},onMessage:function(e){var a,n,i,c=e.bm_method,t=e.bm_value;"mailContentBlocking"===c?cjBasics.navigator.firefox&&(g?g.hidden=!1:((g=cjce.createElement("cjmd-container")).classList.add("bm-p-mail-sheet","bm-p-mail-contentblocking"),i=cjce.createElement("bm-app",{pageId:"pagestateupdate",pageParameters:{contentBlocking:"gmail"},bmApis:s}),g.appendChild(i),o.appendChild(g))):"mailCachedLabels"===c?Array.isArray(t)&&2<t.length&&(a=function(e){for(var a=[],n=[],i={priority:a,other:n},c=!1,t=0;t<e.length;t++){var o=e[t],l=o.id;"^all"===l&&(c=!0),c?(n.push(o),l.startsWith("^")&&(o.type="system")):l in V&&a.push(l);var r=Z[o.id];r&&(o.id=r)}return cjgApis.cache.setItem(s.account,"bm_cache_v30__mail__sqllabels2",i),i}(t),U=!0,_e(a.priority),be(a.other)):"mailHashChange"===c?(C=t,ce()):"mailPageUrl"===c?W=t:"mailSessionId"===c?t&&(cjgApis.cache.setItem(s.account,k,t),n=T+t+"/",cjBasics.webRequest.addListener("onBeforeRequest",function(e){return{redirectUrl:e.url.replace(n,y+"s/")}},{urls:[n+"?view=att&*"],types:["image"]},["blocking"])):"mailSelectionState"===c&&(t?C.startsWith("tl/Draft")?ie("tl-selection-draft"):C.startsWith("tl/Spam")?ie("tl-selection-spam"):C.startsWith("tl/Trash")?ie("tl-selection-trash"):C.startsWith("tl/All")?ie("tl-selection-all"):C.startsWith("tl")&&ie("tl-selection"):ie())}}),o.appendChild(r)}),t=cjce.createElement("cjmd-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_00317","Compose"),onClick:function(){pe("co")},onMetaClick:$}),cjce.createElement("cjmd-fab",{mini:!0,color:!0,iconName:"__mdi:open_in_new",label:cjBasics.lang.i18n("cj_i18n_06325","Compose in new tab"),onClick:$})]}),o.appendChild(t),"openDatabase"in window||(_e(G),cjgApis.cache.getItem(s.account,"bm_cache_v30__mail__apilabels").then(function(e){e&&Array.isArray(e)&&(U||be(e))}),le().then(function(e){U||be(e,!0)})),cjgApis.cache.getItem(s.account,"bm_cache_v30__mail__sqllabels2").then(function(e){return"object"===_typeof(e)&&null!==e&&"priority"in e?e:null}).then(function(e){U||e&&(_e(e.priority),be(e.other))})}()});