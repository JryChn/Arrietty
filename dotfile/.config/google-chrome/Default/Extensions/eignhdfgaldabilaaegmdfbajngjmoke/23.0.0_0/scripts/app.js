"use strict";!function(){var l,n,o,u,r,c,d="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,e=new URLSearchParams(window.location.search),p=!1,m=!1,g=e.get("page"),f=e.get("environment"),b="1"===e.get("debug"),v=!1;function i(n,o){var r,c;n&&(o=o||{},r="newtab"===f?"update":"create",c=!1,d.tabs.query({currentWindow:!0},function(e){for(var a=n.replace("/u/0/","/"),s=e.length;0<s;s--){var i=e[s-1],t=i.pendingUrl||i.url;if("string"==typeof t&&(t.replace("/u/0/","/")===a||t.replace("/u/0/","/").split("?")[0].split("#")[0]===a)){d.tabs.update(i.id,{active:!0}),c=!0;break}}c||d.tabs[r]({active:!0,url:n}),"popup"!==f||o.noClose||window.close()}))}var w,h,j,P,a,s,t,y=(j=g||"search",P={customize:!(w=!(h=[])),accountchooser:!0,removedialog:!0,portal:!0,newtab:!0,pagestateupdate:!0,missingpermissions:!0,contentblocking:!0},{navigate:B,lock:function(e){B(e),w=!0},onChange:function(e){h.push(e),e(j)}});function B(e,a){var s,i,t,n;function o(){e===j&&s.onPageDisplayHandler(a||{})}w||((s=u[e])&&!s.loaded&&(s.loaded=!0,I(e)),i=j=e,n=l.querySelector(":scope > .selected"),i!==(n&&n.dataset.id||null)&&(t=l.querySelector(':scope > [data-id="'+i+'"]'),n&&n.classList.remove("selected"),t&&t.classList.add("selected")),h.forEach(function(e){e(j)}),P[j]||g||browserStorage.local.setItem("bm_pref__portal__lastused",j),s&&(s.onPageDisplayHandler?o():s.lastPageDisplayCallback=o))}function k(e){var a=(e=e||{}).serviceData||{},s=cjgApis.session.account;return{missingGooglePermission:v,debugMode:b,instanceParameters:e.instanceParameters||{},darkMode:a.preferDarkMode?!p:m,setOnPageDisplayHandler:e.setOnPageDisplayHandler,account:s,wizPath:cjgApis.session.wizPath,openTab:i,requirePage:S,loadPage:I,environment:f,standaloneService:g,pageManager:y,userServices:bmBasics.userServices,servicesDatabase:u,ogbFeatures:{onNewTab:!0,portal:cjBasics.navigator.firefoxMobile,notifications:g&&a.showNotifications&&s.validSession,accountchooser:g&&s.validSession,signin:g&&!s.validSession}}}function S(e){var a,s,i,t=u[e]||{},n=t.loadPromise;return n||(a="/pages/"+e+"/index.js",s=[],i=t.preload||[],t.pageId?i.push(t.pageId):s.push(cjBasics.resources.loadScript(a)),t.extraCss&&s.push(cjBasics.resources.loadStyle("/pages/"+e+"/index.css")),Array.isArray(i)&&window.requestIdleCallback&&window.requestIdleCallback(function(){i.forEach(S)},{timeout:2e3}),Array.isArray(t.dependencies)&&t.dependencies.forEach(function(e){s.push(S(e))}),n=Promise.all(s),t.loadPromise=n),n}function I(e){var a=u[e],s=a.pageId||e,i=a.pageParameters,t=!cjBasics.wrif.supported&&a.wrifFallbackPageId;t&&(u[t]?s=t:(s="pagestateupdate",i={productId:e}));var n=cjBasics.navigator.firefox&&a.firefoxFallbackPageId;n&&(s=n);var o=u[s],r=cjgApis.session.account;v&&!o.noGooglePermissionNeeded?(s="pagestateupdate",i={productId:e,missingPermissions:!0}):cjgApis.session.hasContentBlocking&&("valid"===o.requireSignin||cjBasics.navigator.firefox&&o.requireSigninFirefox)?(s="pagestateupdate",i={productId:e,contentBlocking:!0}):!r.validSession&&(o.requireSignin||cjBasics.navigator.firefox&&o.requireSigninFirefox)?(s="pagestateupdate",i={productId:e,signinRequired:!0}):!r.pageId||a.brandAccount&&o.brandAccount||(s="pagestateupdate",i={productId:e,brandAccountUnsupported:!0});var c=k({serviceData:a,setOnPageDisplayHandler:function(e){a.onPageDisplayHandler=e,a.lastPageDisplayCallback&&setTimeout(function(){a.lastPageDisplayCallback(),a.lastPageDisplayCallback=null})},instanceParameters:i}),d=cjce.createElement("bm-app",{pageId:s,bmApis:c});d.dataset.id=e,l.appendChild(d)}function L(){o=browserStorage.sync.getItem("bm_pref__main__language").then(function(e){return cjBasics.lang.overwriteLanguage(e)}),r=cjBasics.ajax("pages.json",{fetchAs:"json"}).then(function(s){return o.then(function(){return Object.keys(s).forEach(function(e){var a=s[e].labelI18n;a&&(s[e].label=cjBasics.lang.i18n(a,s[e].label))}),u=s})}),c=cjBasics.wrif.restoreSupported(),n=browserStorage.sync.getItem("bm_pref__main__theme").then(function(e){"classic"!==e&&("light"!==e?"dark"!==e&&!matchMedia("(prefers-color-scheme: dark)").matches||(m=!0,document.documentElement.classList.add("bm-master--dark")):p=!0)});var s,i,e=["search","maps","translate","news","youtube","gmail","calendar","drive","keep","tasks"];"newtab"===f&&(document.title="New Tab for Googleâ„¢",e=["chromtopsites","chromebookmarks","calendar","keep","news","drive","gmail","tasks","maps","contacts"]),bmBasics.userServices.init({debug:b,defaultServices:e,accountRequest:cjgApis.session.ready,servicesDatabaseRequest:r}),d.runtime.onMessage.addListener(function(e){e.reloadAllInstances&&window.location.reload()}),g||cjBasics.navigator.firefoxMobile||(s="newtab"===f?"newtab":"portal",(i=document.createElement("div")).className="bm-ele-mainportal","newtab"!==f&&i.classList.add("bm-ele-mainportal--sideportal"),"newtab"===f?i.classList.add("bm-ele-mainportal--newtab"):"popup"===f&&i.classList.add("bm-ele-mainportal--inpopup"),document.body.appendChild(i),n.then(function(){p&&i.classList.add("bm-ele-mainportal--light")}),Promise.all([r,n,cjgApis.session.ready]).then(function(){var e=u[s],a=cjce.createElement("bm-app",{pageId:s,bmApis:k({serviceData:e})});i.appendChild(a)})),(l=document.createElement("div")).className="bm-ele-mainwindow",g||"sidebar"===f||"newtab"===f||cjBasics.navigator.firefoxMobile||l.classList.add("bm-ele-mainwindow--sideportal"),"options"!==f&&n.then(function(){m&&l.classList.add("bm-ele-mainwindow--dark")}),"newtab"===f?l.classList.add("bm-ele-mainwindow--newtab"):"popup"!==f||cjBasics.navigator.firefoxMobile||l.classList.add("bm-ele-mainwindow--inpopup"),document.body.appendChild(l);var a=(d.permissions?new Promise(function(a){d.permissions.contains({origins:["https://*.google.com/*"]},function(e){a(e)})}):Promise.resolve(!0)).then(function(e){v=!e}),t=[r,n,c,cjgApis.session.ready,cjBasics.webRequest.getTabId(),a];Promise.all(t).then(function(){g?y.navigate(g):bmBasics.userServices.getLastUsed().then(function(e){y.navigate(e.serviceId)})},function(e){console.error(e)})}t=document.documentElement,"options"===f&&cjBasics.navigator.firefox?t.classList.add("bm-ele-master--autosize"):(g&&"sidebar"!==f&&t.classList.add("bm-ele-master--singlepage"),!cjBasics.navigator.firefoxMobile&&"newtab"!==f&&"sidebar"!==f&&f||t.classList.add("bm-ele-master--fullsize")),cjBasics.navigator.firefox&&t.classList.add("bm-ele-master--firefox"),"popup"===f&&(cjBasics.navigator.mac||cjBasics.navigator.firefox)&&(a=1600,s=500,function e(){document.documentElement.classList.add("bm-ele-master--macfix"),setTimeout(function(){document.documentElement.classList.remove("bm-ele-master--macfix")},20),0<a&&(setTimeout(e,s),a-=s)}()),"popup"===f&&cjBasics.navigator.mac&&d.runtime.sendMessage({closeAuthPopup:!0}),t.dir=d.i18n.getMessage("@@bidi_dir"),t.lang=d.i18n.getUILanguage(),cjBasics.events.focusVisibleHandling(),"popup"===f?"complete"===document.readyState?setTimeout(L,100):window.addEventListener("load",function(){setTimeout(L,100)}):L()}();