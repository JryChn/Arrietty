"use strict";!function(){var t="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,e=t.i18n.getMessage("@@extension_id"),n="https://www.google.com",s=window.location,o=s.href,a=window.top!==window,i=o.startsWith(n+"/cjg-auth/"+e);a&&i&&t.runtime.sendMessage({cjgAuthUrl:o});var c,u,r,d,p,g,h,f,l,m=o.startsWith(n+"/cjg-apis/"+e),j=o.startsWith(t.runtime.getURL("cjg-popup.html"));function w(){document.head.textContent="",document.body.textContent=""}function A(){d||t.runtime.sendMessage({closeAuthPopup:!0})}function v(){t.runtime.sendMessage({reloadAllInstances:!0},A)}function b(){(d?v:A)()}function y(t){cjgApis.session.changeAccount(t,!0).then(v,v),setTimeout(v,1e3)}(i||m||j)&&!a&&("complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?w():window.addEventListener("DOMContentLoaded",w),c=(o.match(/authuser=(\d)/)||[])[1]||null,u=(o.split("access_token=")[1]||"").split("&")[0],r=s.hash.replace("#",""),d=-1!==r.indexOf("--macpopup")&&cjBasics.navigator.mac&&!cjBasics.navigator.opera,p=r.split("--macpopup")[0],g=s.pathname.split("/")[3],h="signin"===g||"signin"===p,f="signout"===g||"signout"===p,l=Boolean(u),cjgApis.session.ready.then(function(){h?cjgApis.account.list({listPages:!1}).then(function(t){var e=t[0];if(c&&"0"!==c)for(var n=0;n<t.length;n++)if(t[n].authuser===c){e=t[n];break}var s=cjgApis.session.account;s.validSession&&s.obfuscatedId===e.obfuscatedId&&s.authuser===e.authuser?b():y(e)},b):f?y(cjgApis.account.noAccountData):l?Promise.all([cjgApis.auth.getTokenInfo(u),cjgApis.account.list({authuser:c})]).then(function(t){var e,n=t[0],s=t[1],o=n.sub;s.forEach(function(t){t.obfuscatedId===o&&o!==cjgApis.session.account.obfuscatedId&&(e=t)}),e?y(e):v()},v):b()}))}();