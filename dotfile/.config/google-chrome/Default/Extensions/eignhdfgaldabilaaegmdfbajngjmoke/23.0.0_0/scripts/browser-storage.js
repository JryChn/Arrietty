"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var browserStorage=function(){var e,s="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,n=s.runtime.getURL("PATH/").replace("/PATH/","").startsWith("moz-extension://"),l=s.storage,t=n;if(!l)throw new Error("Please add storage to the list of permissions in manifest.json");function o(r,o,c){return new Promise(function(n,t){var e="clear"===r?l[o][r][c](c||null,function(e){return s.runtime.lastError?t(s.runtime.lastError):void n(e)}):l[o][r](function(e){return s.runtime.lastError?t(s.runtime.lastError):void n(e)});"object"===_typeof(e)&&"function"==typeof e.then&&n(e)}).catch(function(){return"clear"===r?l[o][r]():l[o][r](c||null)})}function r(e){return function(n){return e(n).then(function(e){return e[n]})}}function c(r){return function(e,n){var t={};return t[e]=n,r(t)}}function u(){return Promise.reject(Error("Method not supported for this storage type"))}return{managed:{get:l.managed&&l.managed.get?o.bind(null,"get","managed"):function(){return Promise.resolve({})},set:u,remove:u,clear:u,getBytesInUse:function(){return Promise.resolve(0)},getItem:r(o.bind(null,"get","managed")),setItem:u},local:(e={getBytesInUse:o.bind(null,"getBytesInUse","local"),set:o.bind(null,"set","local"),remove:o.bind(null,"remove","local")},t?(e.get=function(e){return e?o("get","local",e):o("get","local",null).then(function(n){var t={};return Object.keys(n).forEach(function(e){e.startsWith("__sync_storage__")||"__sync_fallback__"===e||(t[e]=n[e])}),t})},e.clear=function(){return o("get","local",null).then(function(e){return Object.keys(e).filter(function(e){return!e.startsWith("__sync_storage__")})}).then(o.bind(null,"remove","local"))}):(e.get=o.bind(null,"get","local"),e.clear=o.bind(null,"clear","local")),e.getItem=r(e.get),e.setItem=c(e.set),e),sync:function(){var n={};if(!t)return n.get=o.bind(null,"get","sync"),n.set=o.bind(null,"set","sync"),n.remove=o.bind(null,"remove","sync"),n.clear=o.bind(null,"clear","sync"),n.getBytesInUse=o.bind(null,"getBytesInUse","sync"),n.getItem=r(n.get),n.setItem=c(n.set),n;var e=l.sync?new Promise(function(n){l.sync.get("someStorageKey",function(){var e;s.runtime.lastError?n(!1):(e=o("get","local","__sync_fallback__").then(function(e){return!e.__sync_fallback__||o("get","local",null).then(function(n){var t=["__sync_fallback__"],r={};return Object.keys(n).forEach(function(e){e.startsWith("__sync_storage__")&&(t.push(e),r[e.replace("__sync_storage__","")]=n[e])}),Promise.all([o("set","sync",r),o("remove","local",t)])}).then(function(){return!0})}),n(e))})}):Promise.resolve(!1);return n.get=function(t){return e.then(function(e){if(e)return o("get","sync",t);var n=null;return t&&(n=(n="string"==typeof t?[t]:t).map(function(e){return"__sync_storage__"+e})),o("get","local",n).then(function(n){var t={};return Object.keys(n).forEach(function(e){e.startsWith("__sync_storage__")&&(t[e.replace("__sync_storage__","")]=n[e])}),t})})},n.set=function(t){return e.then(function(e){if(e)return o("set","sync",t);var n={__sync_fallback__:!0};return Object.keys(t).forEach(function(e){n["__sync_storage__"+e]=t[e]}),o("set","local",n)})},n.remove=function(n){return e.then(function(e){return e?o("remove","sync",n):o("remove","local",("string"==typeof n?[n]:n).map(function(e){return"__sync_storage__"+e}))})},n.clear=function(){return e.then(function(e){return e?o("clear","sync"):o("get","local",null).then(function(e){return Object.keys(e).filter(function(e){return e.startsWith("__sync_storage__")})}).then(o.bind(null,"remove","local"))})},n.getBytesInUse=function(){return e.then(function(e){return e?o("getBytesInUse","sync"):0})},e.then(function(e){e&&(n.get=o.bind(null,"get","sync"),n.set=o.bind(null,"set","sync"),n.remove=o.bind(null,"remove","sync"),n.clear=o.bind(null,"clear","sync"))}),n.getItem=r(n.get),n.setItem=c(n.set),n}()}}();